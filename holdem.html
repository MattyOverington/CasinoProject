<!doctype html>
    <html>
        <head>
            <meta charset="UTF-8">
            <title>Texas Holdem'</title>
            <link rel="stylesheet" type="text/css" href="mystrap.css">
            <script type="text/javascript" src="pixi.js"></script>
        </head>

        <body>

        <canvas id="holdem_canvas"></canvas>

            <script>

//-----------------------------------------------------------------------------------------------------
//Initialization & Global Variables
//-----------------------------------------------------------------------------------------------------


//Variable Initializtion and Stuffs
var canvas;
var context;
var card_img = new Image();
card_img.src = "cards.gif";

var card_height = 384 / 4;
var card_width = 923 / 13;
//var renderer;
//var stage; 

//Buttons Initialization
var buttons = []
initButtons();

//window.addEventListener('mousedown', interperateClick());


//Game Initialization
var game = new Game(7, 700, 5, 5, 0.5);
game.createDeck();
game.shuffleDeck();
game.initPlayers(); 


game.giveCard(0);
game.giveCard(0);



//Canvas Initialization & Initial Render
initCanvas();
renderPlayerIcons();
renderButtons();
renderStats();

game.round.dealFlop(game);


//-----------------------------------------------------------------------------------------------------
//Constructors
//-----------------------------------------------------------------------------------------------------

//Game Constructor

function Game (numberOfPlayers, initialCash, initialSmallBlind, blindRaiseInterval, blindRaisePercentage) {
    if (numberOfPlayers <= 7) {
        this.numberOfPlayers = numberOfPlayers;
    } else {
        this.numberOfPlayers = 7;
    }
    this.roundNum = 0;
    if (initialCash > 0) {
        this.initialCash = initialCash;
    } else {
        this.initialCash = 4000;
    }

    this.smallBlind = initialSmallBlind;
    this.blindRaiseInterval = blindRaiseInterval;
    this.blindRaisePercentage = blindRaisePercentage;

    this.players = [];
    this.deck = [];

    this.round = new Round(0, this.players, this.smallBlind);
    

    this.createDeck = function() {
        suits = ["D", "H", "C", "S"];
        list = []

        for (i = 0; i < 4; i++) {
            for (j = 2; j <= 14; j++) {
                temp = new Card(suits[i], j);
                list.push(temp);
            }
        }

        this.deck = list;
    }

    this.dealCard = function() {
        i = this.deck[0];

        this.deck.splice(0, 1);
        return i;
    }

    this.giveCard = function(p) {
        player = game.players[p];

        player.currentHand.push(this.dealCard());
    }

    this.shuffleDeck = function() {

        temp = []
        len = this.deck.length;

        for (i = 0; i < len + 1; i++) {
            j = Math.floor(Math.random() * (52 - i))
            temp.push(this.deck[j])
            this.deck.splice(j, 1);
        }

        this.deck = temp;
    }


    this.initPlayers = function() {
        colours = ["red", "blue", "green", "yellow", "cyan", "maroon", "white"];
        console.log(this.initialCash)
        for (i = 0; i <  this.numberOfPlayers; i++) {
            temp = new Player (i, colours[i], "Jeff", Math.floor(this.initialCash/this.numberOfPlayers), true);
            if (i == 0) {
                temp.isAI = false;
                temp.name = 'Fezza';
            }
            this.players.push(temp); 
        }
    }

}

//Round Constructor

function Round(number, players, smallBlind) {
    this.number = number;
    this.players = players;
    this.smallBlind = smallBlind;
    this.bigBlind = smallBlind * 2;
    this.minimumBet = smallBlind * 2;

    this.community_cards = [];
    this.pot = [];
    this.player_actions = [];
    this.roundPlayers = [];
    this.highBet = 0;

    this.dealFlop = function(game) {
        this.community_cards.push(game.dealCard())
        this.community_cards.push(game.dealCard())
        this.community_cards.push(game.dealCard())
        console.log(this.community_cards);
        renderCards();
    }
}

//Card Constructor

function Card (suit, number) {
    this.suit = suit;
    this.number = number;
}

//Player Constructor

function Player (number, colour, name, balance, isAI) {
    this.number = number;
    this.colour = colour;
    this.name = name;
    this.balance = balance;
    this.rank = 0;
    this.isAI = isAI;

    this.currentHand = [];
    this.hasCurrentTurn = false;
    this.blindStatus = null;
    this.hasHighBet = false;
}

function Button (name, x, y, width, height, displayText) {
    this.name = name;
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    this.displayText = displayText;
    this.function;

    this.checkClick = function(mx, my) {

    }
}

//-----------------------------------------------------------------------------------------------------
//Canvas & Pixi Methods
//-----------------------------------------------------------------------------------------------------

function initCanvas() {
    canvas = document.getElementById("holdem_canvas");
    canvas.height = window.innerHeight;     
    canvas.width = window.innerWidth;
    context = canvas.getContext("2d");
}

function initPixi() {
    renderer =  new PIXI.CanvasRenderer(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.view);
    stage = new PIXI.Container();

}

//-----------------------------------------------------------------------------------------------------
//Control and Interaction Methods
//-----------------------------------------------------------------------------------------------------

function initButtons() {
    var buttony = 485
    var buttony2 = buttony + 30
    var buttonHeight = 18;



    foldButton = new Button('fold', 490 + 135, buttony, 40, buttonHeight, "Fold");
    checkButton = new Button('check', 541 + 135, buttony, 50, buttonHeight, "Check");
    callButton = new Button('call', 602 + 135, buttony, 40, buttonHeight, "Call");
    add5button = new Button('5', 490 + 135, buttony2, 30, buttonHeight, "$5");
    add10button = new Button('10', 530 + 135, buttony2, 30, buttonHeight, "$10");
    add50button = new Button('50', 570 + 135, buttony2, 30, buttonHeight, "$50");
    add100button = new Button('100', 610 + 135, buttony2, 40, buttonHeight, "$100");
    allInButton = new Button('all in', 655 + 135, buttony, 50, buttonHeight, "All In");
    betButton = new Button('bet', 660 + 135, buttony2, 45, buttonHeight, "Raise");
    buttons.push(foldButton);
    buttons.push(checkButton);
    buttons.push(callButton);
    buttons.push(add5button);
    buttons.push(add10button);
    buttons.push(add50button);
    buttons.push(add100button);
    buttons.push(allInButton);
    buttons.push(betButton);
}


//-----------------------------------------------------------------------------------------------------
//Rendering Methods
//-----------------------------------------------------------------------------------------------------


function renderPlayerIcons() {
    for (i = 0; i < game.numberOfPlayers; i++) {

        player = game.players[i];
        dotx = (window.innerWidth - (90 * (game.numberOfPlayers - 1)))/2 + (90 * player.number);
        infox = dotx + 20;        
        
        context.beginPath();
        context.arc(dotx, 25 , 10, 0, 2 * Math.PI, false);
        context.fillStyle = player.colour;
        context.lineWidth = 6;
        if (player.hasCurrentTurn == true) {
            context.strokeStyle = 'orange';
        } else {
            context.strokeStyle = 'black';
        }
        context.stroke();
        context.fill();

        context.font = "14px Century"
        context.fillStyle = 'black'
        context.fillText(player.name, infox, 50)

        context.fillStyle = 'white'
        context.fillText("$" + player.balance, infox, 29) 

    }
}

function renderButtons() {
    for(i = 0; i < buttons.length; i++) {
        button = buttons[i];
        context.beginPath();
        context.rect(button.x, button.y, button.width, button.height);
        context.strokeStyle = 'black';
        context.fillStyle = 'maroon'
        context.lineWidth = 5
        context.stroke()
        context.fill()

        context.font = "14px Century"
        context.fillStyle = 'white'
        context.fillText(button.displayText, button.x + 5, button.y + 13)
    }
}
function renderStats() {
    player = game.players[0];
    context.font = 'Bold 64px Century'
    context.fillStyle = 'black'
    context.fillText("$" + player.balance, 630, 445);
}

function renderCards() {
    card_img.onload = function() {
        renderStartingHand();
        renderCommunityCards();
    }
}

function renderStartingHand() {
    player = game.players[0]
    cards = player.currentHand
    startx = 515;
    y = 375;
    for (i = 0; i < 2; i ++) {
        renderCard(cards[i], startx + (i * 40), y);
    }
}

function renderCommunityCards() {
    cards = game.round.community_cards
    y = 230;
    startx = 485;

    for (i = 0; i < cards.length; i++) {
        renderCard(cards[i], startx + (i * 80), y);
    }
}

function renderCard(card, x, y) {

    suits = ["D", "H", "C", "S"];

    row = suits.indexOf(card.suit);  

    if (card.number == 14) {
        column = 0
    } else {
        column = card.number - 1;   
    }

    pixelsLeft = card_width * column;
    pixelsTop = card_height * row;

    
    context.drawImage(card_img, pixelsLeft, pixelsTop, card_width, card_height, x, y, card_width, card_height);
}

function clearFloor() {
    context.clearRect(0, 0, window.innerWidth, window.innerHeight);
}


            </script>

        </body>
    </html>
