<!doctype html>
    <html>
        <head>
            <meta charset="UTF-8">
            <title>Texas Holdem'</title>
            <link rel="stylesheet" type="text/css" href="mystrap.css">
            <script type="text/javascript" src="pixi.js"></script>
        </head>

        <body>

        <canvas id="holdem_canvas"></canvas>

            <script>

//-----------------------------------------------------------------------------------------------------
//Initialization & Global Variables
//-----------------------------------------------------------------------------------------------------


var canvas;
var context;
var card_img = new Image();
card_img.src = "cards.gif";

var card_height = 384 / 4;
var card_width = 923 / 13;
//var renderer;
//var stage; 

var game = new Game(4, 400, 5, 5, 0.5);
game.createDeck();
game.shuffleDeck();
game.initPlayers(); 

initCanvas();
renderPlayerIcons();

card_img.onload = function() {
    renderFrame();
}




//-----------------------------------------------------------------------------------------------------
//Constructors
//-----------------------------------------------------------------------------------------------------

//Game Constructor

function Game (numberOfPlayers, initialCash, initialSmallBlind, blindRaiseInterval, blindRaisePercentage) {
    if (numberOfPlayers <= 7) {
        this.numberOfPlayers = numberOfPlayers;
    } else {
        this.numberOfPlayers = 7;
    }
    this.roundNum = 0;
    if (initialCash > 0) {
        this.initialCash = initialCash;
    } else {
        this.initialCash = 4000;
    }
    this.initialSmallBlind = initialSmallBlind;
    this.blindRaiseInterval = blindRaiseInterval;
    this.blindRaisePercentage = blindRaisePercentage;
    this.players = [];
    this.deck = [];
    this.community_cards = [];
    this.pot = [];
    this.player_actions = [];

    this.createDeck = function() {
        suits = ["D", "H", "C", "S"];

        for (i = 0; i < 4; i++) {
            for (j = 1; j <= 13; j++) {
                temp = new Card;
                temp.suit = suits[i];
                temp.number = j;
                this.deck.push(temp);
            }
        }
    }

    this.dealCard = function(player) {
        i = this.deck[0];

        game.temp = deck[i];
        deck.splice(i, 1);
        player.currentHand.push(temp);
    }

    this.shuffleDeck = function() {

        temp = []
        len = this.deck.length;

        for (i = 0; i < 52; i++) {
            j = Math.floor(Math.random() * (52 - i))
            temp.push(this.deck[j])
            this.deck.splice(j, 1);
        }

        this.deck = temp;
    }


    this.initPlayers = function() {
        colours = ["red", "blue", "white", "orange", "purple", "yellow", "white"];
        for (i = 0; i <= this.numberOfPlayers; i++) {
            temp = new Player (i, colours[i], "Jimmy", (this.initialCash/this.numberOfPlayers), true);
            if (i == 0) {
                temp.isAI = false;
                temp.name = 'Fezza';
            }
            this.players.push(temp); 
        }
    }

    this.startRound = function() {
        for (var i in this.players) {
            i.currentHand = []
        }

        for (var i in this.players) {
            this.dealCard(i)
        }
        for (var i in this.players) {
            this.dealCard(i)
        }
    }

}

//Card Constructor

function Card (suit, number) {
    this.suit = suit;
    this.number = number;
}

//Player Constructor

function Player (number, colour, name, balance, isAI) {
    this.number = number;
    this.colour = colour;
    this.name = name;
    this.rank = 0;
    this.currentHand = [];
    this.isAI = isAI;
}

//-----------------------------------------------------------------------------------------------------
//Canvas & Pixi Methods
//-----------------------------------------------------------------------------------------------------

function initCanvas() {
    canvas = document.getElementById("holdem_canvas");
    canvas.height = window.innerHeight;     
    canvas.width = window.innerWidth;
    context = canvas.getContext("2d");
}

function initPixi() {
    renderer =  new PIXI.CanvasRenderer(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.view);
    stage = new PIXI.Container();

}


//-----------------------------------------------------------------------------------------------------
//Rendering Methods
//-----------------------------------------------------------------------------------------------------


function renderPlayerIcons() {
    for (var i in game.players) {
        console.log(i);
        context.beginPath();
        context.arc(600 + 10*i.number, 25 , 10, 0, 2 * Math.PI, false);
        context.fillStyle = i.colour;
        context.lineWidth = 2;
        context.fill();
    }
}

function renderFrame() {
    renderCard(game.deck[0], 490, 450);
    renderCard(game.deck[1], 530, 450);
}

function renderCard(card, x, y) {
    suits = ["D", "H", "C", "S"];

    row = suits.indexOf(card.suit);
    column = card.number - 1;

    pixelsLeft = card_width * column;
    pixelsTop = card_height * row;

    
    context.drawImage(card_img, pixelsLeft, pixelsTop, card_width, card_height, x, y, card_width, card_height);
}

function clearFloor() {
    context.clearRect(0, 0, window.innerWidth, window.innerHeight);
}


            </script>

        </body>
    </html>
